import{b as i,f as x,d as mt,t as Yt}from"../chunks/DvwRGfww.js";import"../chunks/ZwUaS2xh.js";import{o as Zt}from"../chunks/ClGfkG1t.js";import{an as te,ao as B,ap as ee,aw as $,aq as ae,a as t,E as s,s as r,as as u,au as l,ar as g,ax as Y,u as _,t as S,ay as Z}from"../chunks/BuYk74-E.js";import{s as y,e as re}from"../chunks/YEDV7OB7.js";import{i as E}from"../chunks/CsOpSJIT.js";import{e as $t,i as St}from"../chunks/DgmZXuMA.js";import{s as se}from"../chunks/CFqlu25O.js";import{s as oe}from"../chunks/DjxTXd-0.js";import{b as ne}from"../chunks/E4uvHImo.js";import{i as ie}from"../chunks/DowsAlf2.js";import{s as le,a as ce}from"../chunks/BvfUDuFd.js";import{b as ve}from"../chunks/ktU8I4Um.js";import{p as de}from"../chunks/B5R5pkoP.js";import{C as fe}from"../chunks/CMb3mhhO.js";var me=x('<div class="timer svelte-17kww11"> </div>'),pe=x("<span></span> ",1),ue=x('<span class="revealed correct-word svelte-17kww11"> </span> ',1),_e=x('<span class="revealed wrong-word svelte-17kww11"> </span> ',1),he=x('<p class="kor svelte-17kww11"> </p> <p class="eng svelte-17kww11"></p>',1),we=x('<button class="choice-btn svelte-17kww11"> </button>'),ge=x('<div class="choices svelte-17kww11"></div>'),xe=x('<div class="sentence-box svelte-17kww11"><div class="order-big svelte-17kww11"> </div> <!> <!></div> <!>',1),ke=x('<div class="result-list svelte-17kww11"><h2 class="svelte-17kww11"> </h2> <h2 class="svelte-17kww11"> </h2></div>'),be=x('<main class="wrapper svelte-17kww11"><!></main> <!> <audio playsinline="" preload="auto" class="svelte-17kww11"></audio>',1);function Ve(yt,Bt){te(Bt,!1);const pt=()=>ce(de,"$page",It),[It,Tt]=le(),tt=s(),F=s(),Ct=s(),z=s(),k=s(),ut=s(),_t=s(),ht=s(),wt=[10,20,50,-1],gt=[10,30,-1],Et=/[.,!?]/g;let H=s(0),J=s(0),U=[],et=s([]),at=[],c=s([]),f=s([]),xt=s(),v=s(-1),rt=s(0),st=s(!1),b=s(0),V=s(0),I=s(0),j=s(0),K;const G=new Set,Q=e=>e.replace(Et,""),zt=e=>{for(let a=e.length-1;a>0;a--){const o=Math.floor(Math.random()*(a+1));[e[a],e[o]]=[e[o],e[a]]}return e},jt=()=>{if(t(z)>=0&&G.size>=t(z)||G.size===U.length)return-1;let e;do e=Math.floor(Math.random()*U.length);while(G.has(e));return e};Zt(async()=>{const e=await fetch(`${t(F)}/sentences.json`);if(!e.ok)return;const a=await e.json();U=a.sentences,r(et,a.korean),at=[...new Set(U.flatMap(o=>o.split(" ").map(Q)))]});function At(){W(),!(t(k)<0)&&(r(j,t(k)),K=setInterval(()=>{Y(j,-1),t(j)<=0&&(W(),ot())},1e3))}function W(){K&&clearInterval(K),K=void 0}function Nt(e){const a=U[e].split(" "),o=new Set,h=Math.min(4,3+Math.floor(Math.random()*2));for(;o.size<Math.min(h,a.length);)o.add(Math.floor(Math.random()*a.length));r(f,[...o].map(d=>{const m=Q(a[d]),M=new Set([m]);for(;M.size<10;)M.add(at[Math.floor(Math.random()*at.length)]);return{index:d,choices:zt([...M])}}).sort((d,m)=>d.index-m.index)),r(c,a.map((d,m)=>{const M=o.has(m);return{text:d,isBlank:M,active:M&&m===t(f)[0].index,len:M?Math.max(Q(d).length,3):0,result:void 0}})),r(b,0),At()}function ot(){const e=jt();if(e===-1){r(st,!0),W();return}r(v,e),Y(rt),G.add(e),Nt(e),r(I,t(I)+t(f).length)}function Pt(e){const{index:a}=t(f)[t(b)],o=Q(t(c)[a].text),h=e===o;h&&Y(V),Z(c,t(c)[a].isBlank=!1),Z(c,t(c)[a].active=!1),Z(c,t(c)[a].result=h?"correct":"wrong"),Y(b),t(b)<t(f).length?Z(c,t(c)[t(f)[t(b)].index].active=!0):ot()}function nt(){W(),r(v,-1),r(rt,r(V,r(I,r(j,0)))),r(st,!1),G.clear(),r(c,[]),r(f,[])}function Ut(e){const{id:a}=e.detail;a==="start"&&(t(v)===-1?ot():nt()),a==="count"&&(r(H,(t(H)+1)%wt.length),nt()),a==="time"&&(r(J,(t(J)+1)%gt.length),nt())}B(()=>pt(),()=>{r(tt,pt().params.id)}),B(()=>t(tt),()=>{r(F,`${ve}/assets/sentence/${t(tt)}`)}),B(()=>t(F),()=>{r(Ct,`${t(F)}/audio`)}),B(()=>t(H),()=>{r(z,wt[t(H)])}),B(()=>t(J),()=>{r(k,gt[t(J)])}),B(()=>(t(I),t(V)),()=>{r(ut,t(I)?Math.round(t(V)/t(I)*100):0)}),B(()=>(t(k),t(j)),()=>{r(_t,t(k)<0?"∞":`${t(j)}s`)}),B(()=>(t(v),t(z),t(k)),()=>{r(ht,[{id:"start",icon:t(v)===-1?"▶":"⏹"},{id:"count",text:t(z)<0?"전체":`${t(z)}개`},{id:"time",text:t(k)<0?"∞":`${t(k)}s`}])}),ee(),ie();var kt=be(),it=$(kt),Vt=u(it);{var Gt=e=>{var a=xe(),o=$(a),h=u(o),d=u(h,!0);l(h);var m=g(h,2);{var M=p=>{var w=me(),T=u(w);l(w),S(()=>y(T,`⏱ ${t(_t)??""}`)),i(p,w)};E(m,p=>{t(k)>=0&&t(v)!==-1&&p(M)})}var qt=g(m,2);{var Dt=p=>{var w=he(),T=$(w),X=u(T,!0);l(T);var C=g(T,2);$t(C,5,()=>t(c),St,(lt,n)=>{var Mt=mt(),Ht=$(Mt);{var Jt=A=>{var O=pe(),R=$(O),ct=g(R,1,!0);ct.nodeValue=" ",S(()=>{se(R,1,`blank ${t(n),_(()=>t(n).active?"highlight":"")??""}`,"svelte-17kww11"),oe(R,`width:${t(n),_(()=>t(n).len)??""}ch;`)}),i(A,O)},Kt=A=>{var O=mt(),R=$(O);{var ct=N=>{var q=ue(),D=$(q),vt=u(D,!0);l(D);var dt=g(D,1,!0);dt.nodeValue=" ",S(()=>y(vt,(t(n),_(()=>t(n).text)))),i(N,q)},Qt=N=>{var q=mt(),D=$(q);{var vt=P=>{var L=_e(),ft=$(L),Wt=u(ft,!0);l(ft);var Xt=g(ft,1,!0);Xt.nodeValue=" ",S(()=>y(Wt,(t(n),_(()=>t(n).text)))),i(P,L)},dt=P=>{var L=Yt();S(()=>y(L,`${t(n),_(()=>t(n).text)??""} `)),i(P,L)};E(D,P=>{t(n),_(()=>t(n).result==="wrong")?P(vt):P(dt,!1)},!0)}i(N,q)};E(R,N=>{t(n),_(()=>t(n).result==="correct")?N(ct):N(Qt,!1)},!0)}i(A,O)};E(Ht,A=>{t(n),_(()=>t(n).isBlank)?A(Jt):A(Kt,!1)})}i(lt,Mt)}),l(C),S(()=>y(X,(t(et),t(v),_(()=>t(et)[t(v)])))),i(p,w)};E(qt,p=>{t(v)!==-1&&p(Dt)})}l(o);var Lt=g(o,2);{var Ft=p=>{var w=ge();$t(w,5,()=>(t(f),t(b),_(()=>t(f)[t(b)].choices)),St,(T,X)=>{var C=we(),lt=u(C,!0);l(C),S(()=>y(lt,t(X))),re("click",C,()=>Pt(t(X))),i(T,C)}),l(w),i(p,w)};E(Lt,p=>{t(v),t(b),t(f),_(()=>t(v)!==-1&&t(b)<t(f).length)&&p(Ft)})}S(()=>y(d,t(v)===-1?"Ready":`#${t(rt)}`)),i(e,a)},Ot=e=>{var a=ke(),o=u(a),h=u(o);l(o);var d=g(o,2),m=u(d);l(d),l(a),S(()=>{y(h,`정답 : ${t(V)??""} / ${t(I)??""}`),y(m,`점수 : ${t(ut)??""}점`)}),i(e,a)};E(Vt,e=>{t(st)?e(Ot,!1):e(Gt)})}l(it);var bt=g(it,2);fe(bt,{get buttons(){return t(ht)},$$events:{click:Ut}});var Rt=g(bt,2);ne(Rt,e=>r(xt,e),()=>t(xt)),i(yt,kt),ae(),Tt()}export{Ve as component};
