import{b as E,f as z}from"../chunks/DvwRGfww.js";import"../chunks/ZwUaS2xh.js";import{o as le,a as ne}from"../chunks/ClGfkG1t.js";import{an as ve,ao as F,ap as de,aw as pe,aq as ce,a as e,E as o,ar as b,s as t,as as m,az as me,ay as T,au as d,t as C,u as k}from"../chunks/BuYk74-E.js";import{e as I,s as S}from"../chunks/YEDV7OB7.js";import{i as V}from"../chunks/CsOpSJIT.js";import{e as ue,i as fe}from"../chunks/DgmZXuMA.js";import{s as G}from"../chunks/YzEcovnq.js";import{s as ge}from"../chunks/CFqlu25O.js";import{s as H}from"../chunks/DjxTXd-0.js";import{b as _e}from"../chunks/E4uvHImo.js";import{i as be}from"../chunks/DowsAlf2.js";import{s as he,a as $e}from"../chunks/BvfUDuFd.js";import{p as ke}from"../chunks/DjIpkKxX.js";import{b as ye}from"../chunks/DZVfgf3p.js";import{C as xe}from"../chunks/CMb3mhhO.js";var we=z('<div class="photo svelte-buj2v"><div class="label svelte-buj2v"> </div> <img class="svelte-buj2v"/></div>'),je=z('<div class="kor svelte-buj2v"> </div>'),Ee=z('<div><div class="speaker svelte-buj2v"> </div> <div class="text"> </div> <!></div>'),Se=z('<div class="wrap svelte-buj2v"><div class="main svelte-buj2v"><!> <div class="dialogue svelte-buj2v"></div></div></div> <!> <audio playsinline="" preload="auto" style="display:none"></audio>',1);function Ge(J,L){ve(L,!1);const A=()=>$e(ke,"$page",Q),[Q,U]=he(),y=o(),u=o(),M=o();let i=o([]),f=o({}),r=o(-1),p=o(!1),c=o("none"),x=o("1.2em"),h=o(!0),$=o(!0),l=o();le(async()=>{if(!e(y))return;const a=await fetch(`${e(u)}/dialogue.json`);if(!a.ok)return;const s=await a.json();t(f,s.persons),t(i,s.conversation.map((v,n)=>({...v,file:`${e(u)}/audio/${String(n+1).padStart(2,"0")}.mp3`})))}),ne(()=>e(l)?.pause());async function g(a,s=!0){if(a<0||a>=e(i).length){t(p,!1);return}t(r,a),await me(),document.getElementById(`segment-${a}`)?.scrollIntoView({behavior:"smooth",block:"center"}),e(l).pause(),T(l,e(l).src=e(i)[a].file),T(l,e(l).muted=!!e(f)[e(i)[a].speaker]?.hideEnglish);try{await e(l).play()}catch{t(p,!1);return}t(p,!0)}function W(){e(c)==="segment"?g(e(r),!1):e(r)<e(i).length-1?g(e(r)+1):e(c)==="all"?g(0):t(p,!1)}function X(){e(p)?(e(l).pause(),t(p,!1)):e(r)===-1?g(0):g(e(r),!1)}function Y(){t(c,e(c)==="none"?"all":e(c)==="all"?"segment":"none")}function Z(a){a.target.src=`${e(u)}/ready.webp`}function ee(a){switch(a.detail.id){case"play":X();break;case"repeat":Y();break;case"kor":t(h,!e(h));break;case"size":t(x,e(x)==="1.2em"?"2em":"1.2em");break;case"photo":t($,!e($));break}}F(()=>A(),()=>{t(y,A().url.pathname.match(/\/dialogue\/([^\/]+)/)?.[1]||"")}),F(()=>e(y),()=>{t(u,`${ye}/assets/dialogue/${e(y)}`)}),F(()=>(e(p),e(c),e(h),e($)),()=>{t(M,[{id:"play",icon:e(p)?"⏸":"▶"},{id:"repeat",text:`반복:${e(c)==="none"?"없음":e(c)==="all"?"전체":"구간"}`},{id:"kor",text:e(h)?"한글 ON":"한글 OFF"},{id:"size",text:"크기"},{id:"photo",text:e($)?"사진 ON":"사진 OFF"}])}),de(),be();var N=Se(),O=pe(N),P=m(O),q=m(P);{var ae=a=>{var s=we(),v=m(s),n=m(v,!0);d(v);var _=b(v,2);d(s),C(()=>{S(n,(e(f),e(i),e(r),k(()=>e(f)[e(i)[e(r)]?.speaker]?.name||""))),G(_,"src",(e(i),e(r),e(u),k(()=>e(i)[e(r)]?.speaker?`${e(u)}/${e(i)[e(r)].speaker}.webp`:`${e(u)}/ready.webp`)))}),I("error",_,Z),E(a,s)};V(q,a=>{e($)&&a(ae)})}var D=b(q,2);ue(D,5,()=>e(i),fe,(a,s,v)=>{var n=Ee();G(n,"id",`segment-${v}`);var _=m(n),te=m(_);d(_);var w=b(_,2),se=m(w,!0);d(w);var re=b(w,2);{var oe=B=>{var j=je(),ie=m(j,!0);d(j),C(()=>{H(j,`font-size:${e(x)??""}`),S(ie,(e(s),k(()=>e(s).korean)))}),E(B,j)};V(re,B=>{e(h)&&B(oe)})}d(n),C(()=>{ge(n,1,`seg ${v===e(r)?"active":""}`,"svelte-buj2v"),S(te,`${e(f),e(s),k(()=>e(f)[e(s).speaker]?.name)??""}:`),H(w,`font-size:${e(x)??""}`),S(se,(e(s),k(()=>e(s).text)))}),I("click",n,()=>g(v)),E(a,n)}),d(D),d(P),d(O);var K=b(O,2);xe(K,{get buttons(){return e(M)},$$events:{click:ee}});var R=b(K,2);_e(R,a=>t(l,a),()=>e(l)),I("ended",R,W),E(J,N),ce(),U()}export{Ge as component};
